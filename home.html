<!DOCTYPE html>

<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="./stylesheets/cfg.css">
    <link rel="stylesheet" href="./stylesheets/inputs.css">
    <link rel="stylesheet" href="./stylesheets/viewport.css">
    <script src="./javascripts/editor/menus.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="./javascripts/editor/inputs.js"></script>   
    <script src="./javascripts/editor/main.js"></script>   
    <script src="./javascripts/editor/explorer/fileHandler.js"></script>   
    <script src="./javascripts/editor/dragHandler.js"></script>   
    <script src="./javascripts/editor/explorer/widgets.js"></script>   
    <script src="./javascripts/editor/explorer/edit.js"></script>   
    <script src="./javascripts/editor/undoHandler.js"></script>   
    <script src="./javascripts/editor/shortcuts.js"></script>   
    <script src="./javascripts/editor/explorer/tabHandler.js"></script>   
    <script src="./javascripts/editor/timeline.js"></script>   
    <script src="./javascripts/editor/widget-executor.js"></script>   
    <script src="./javascripts/editor/explorer/editScript.js"></script>   
    <script src="./javascripts/editor/saveLoadProjectFiles.js"></script>   

</head>

<body>
<!--
    <div id="blocking-loading-pane">
        <div class="positioner">
            <h1>Loading</h1>
            <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
        </div>
    </div>  
-->
    <p id="project-name">Developer Mode</p>
    <div id="main-container-wrapper">
        <!--Application bar-->
        <div id="app-bar">
            <div class="app-bar-menu-container">
                <div class="icon">
                    <img src="./internalResources/images/icon.png">
                </div>

            </div>
            <div id="drag-region"></div>
            <!--
            <div id="app-bar-dropdown-menus">
                <div class="options" style="margin-left: 1rem;"><h1>File</h1></div>
                <div class="options"><h1>Help</h1></div>
                <div class="options"><h1>Contact</h1></div>
            </div>-->
        
        </div>

        <div id="main-container">

            <div id="top-layer">
                <div class="browser-container smooth-shadow">
                    <div id="browser">
                        <div class="wrapper" style="height: 100%; width: 100%;">
                            <div class="side-bar">

                                <div class="buttons-container">
                                    <script>var scr = document.currentScript; setTimeout(function(){activateBrowserItem('files', scr.parentNode.getElementsByTagName("div")[2])}, 100); //Activate on startup</script>
                                    <div class="button" onclick="activateBrowserItem('edit', this)"><i class="material-icons" style="color: white;">edit</i><script>var el = document.currentScript.parentNode; infoOnHover(el, "Edit menu");</script></div>
                                    <div class="button" onclick="activateBrowserItem('widgets', this)"><i class="material-icons" style="color: white;">widgets</i><script>var el = document.currentScript.parentNode;  infoOnHover(el, "Widgets");</script></div>
                                    <div class="button" onclick="activateBrowserItem('files', this)"><i class="material-icons" style="color: white;">folder_open</i><script>var el = document.currentScript.parentNode;  infoOnHover(el, "File explorer");</script></div>

                                </div>

                            </div>

                            <div class="content-container">
                                <div id="edit" style="display: none;">
                                    <!--
                                    <p>Time</p>
                                    <input value="00:10">

                                    <p style="margin-top: 1rem; margin-bottom: 0.5rem;">Default background image</p>
                                    <input type="file" id="default-bg-img">
                                    <label for="default-bg-img">Choose a file</label>
                                    <div class="container">
                                        <button style="font-size: 1rem; display: inline-block; cursor: pointer; background-color: var(--main-button-color); padding: 0.5rem; color: var(--paragraph-color); border-radius: 0.25rem; margin-top: 1.5rem; border: none; outline: none; font-family: Bahnschrift">Clear column</button>
                                        <div class="info-circle" style="display: inline-block;">?</div>
                                        <script>infoBox(document.currentScript.parentNode.childNodes[3], "Clear all of the elements in the selected column")</script>

                                    </div>-->
                                    <p>Work in progress</p>
                                </div>
                                <div id="widgets" style="display: none;"></div>
                                <div id="files" style="display: none;"><button id="add-files-button" onclick="addFiles()" class="smooth-shadow">+</button><div id="files-container"></div></div> <!--Will have dynamically changing content-->
                            </div>
                        </div>
                        <div class="wrapper">
                            <div class="scroller browser-tab-container">

                                <p id="empty">No open tabs</p>

                            </div>



                            <!--Info circle-->
        <!--
                            <div class="question-circle">
                                <div class="info-circle smooth-shadow" style="display: inline-block;">?</div>
                                <script>infoBox(document.currentScript.parentNode.childNodes[1], "All of your open tabs will be placed here.<br> To open a tab, open the properties of an element.")</script>
                            </div>-->
                            
                        </div>
                    </div>
                </div>
                <div id="viewport" class="smooth-shadow">
                    <div class="controls">
                        <input class="fd-slider" type="range" min="0" max="100" step="1" value="0">
                        <div class="action-buttons">
                            <button onclick="renderer.playPauseSlideshow()"class="ripple-element" id="play"><i class="material-icons">play_arrow</i><script>infoOnHover(document.currentScript.parentNode, "Play")</script></button>
                            <button id="prev" onclick="activateColumnNo(0, 2)" class="ripple-element"><i class="material-icons">skip_previous</i><script>infoOnHover(document.currentScript.parentNode, "Previous slide")</script></button>
                            <button id="next" onclick="activateColumnNo(0, 1)" class="ripple-element"><i class="material-icons">skip_next</i><script>infoOnHover(document.currentScript.parentNode, "Next slide")</script></button>
                        </div>
                    </div>
                    <div id="content">
                        <div class="container" droppable name="viewport-content"></div>
                    </div>
                    <div class="settings-bar">
                        <div class="header">
                            <p>Viewport Settings</p>
                            <button class="close-button" onclick="closeViewportSettings(this)"><i class="material-icons">highlight_off</i></button>
                        </div>
                        
                        <div class="content">
                            <script>
                                var script = document.currentScript;
                                var opts = ["16:9", "8:5", "9:16", "5:4", "2:3", "4:3"];
                                var menu = fsinputs.dropdown(opts);

                                var p = document.createElement("p");
                                p.innerHTML = "Aspect ratio";
                                script.parentNode.appendChild(p);

                                script.parentNode.appendChild(menu);
                            </script>


                            <script>
                                var script = document.currentScript;
                                var opts = ["Black", "White", "Coral", "Blue"];
                                var menu = fsinputs.dropdown(opts);

                                var p = document.createElement("p");
                                p.innerHTML = "Viewport color";
                                script.parentNode.appendChild(p);

                                script.parentNode.appendChild(menu);
                            </script>

                            <script>
                                var script = document.currentScript;
                                var opts = ["Yes", "No", "Yes", "Maybe", ":))"];
                                var menu = fsinputs.dropdown(opts);

                                var p = document.createElement("p");
                                p.innerHTML = "blahblahblahhhhh";
                                script.parentNode.appendChild(p);

                                script.parentNode.appendChild(menu);
                            </script>

                        </div>


                    </div>
                    <div class="settings-button" onclick="viewportSettings()"><i class="material-icons">settings</i></div>
                </div>

            </div>

            <div id="bottom-layer">

                <div id="timeline" class="smooth-shadow">

                    <div class="side-bar">



                    </div>

                    <div class="sub-container">

                        <div class="top-bar">

                        </div>

                        <div class="scrubber"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <script src="./javascripts/editor/background-scripts.js" async defer></script>
    <script src="./javascripts/editor/app-bar.js"></script>
    <script src="./javascripts/editor/notrification-handler.js" async defer></script>   
    <script src="./javascripts/editor/viewport.js"></script>   
<!--<script src="/javascripts/drag-handler.js" async defer></script>
<script src="/javascripts/main.js"></script>
    <link rel="stylesheet" href="/stylesheets/file-explorer.css">

    <script src="/javascripts/version-control.js"></script>
-->

    <script>
                
        const effectsWindow = new effects();
        window.onload = function () {
            //Get the width and height of the timeline element to calculate the 
            //nescessary amount of rows and columns to cover the entire
            //element
            document.body.setAttribute("onresize", "calculateLayout()")
            calculateLayoutOnStartup();

            sendConsoleWarn();
            var path = document.getElementById("main-container").querySelector("#bottom-layer").querySelector("#timeline");
            var w = parseInt(window.getComputedStyle(path).width.split("px"));
            var h = parseInt(window.getComputedStyle(path).height.split("px"));
            var elW = 96;
            var elH = 64;

            //Compensate for the side-bar and top-bar
            var NoCols = Math.round((w-64)/96) + 3;
            var NoRows = Math.round((h-64)/64) + 3;

            //Select column 0 by default
            initScrubber(NoRows,NoCols, 0);
            setTimeout(() => {
                document.querySelector("#timeline > div.sub-container > div.scrubber").scrollLeft = 0;
                document.querySelector("#timeline > div.sub-container > div.scrubber").scrollTop = 0;
            }, 100);
            
            loadFilesIntoExplorer();
            loadWidgets();

            enableAppBarButtons();

            //Add ripple on click effect to all the desired elements
            var buttons = document.getElementsByClassName("ripple-element");
            var x;
            for(x of buttons) {
                appendRipple(x);
            }



            if(document.getElementById("blocking-loading-pane")) {
                var introStr = "Loading";
                //var introStr = generateIntroText();
                document.getElementById("blocking-loading-pane").querySelector(".positioner").getElementsByTagName("h1")[0].innerHTML = introStr;
            }
            //Start off with showing the file explorer
            //this can be changed to something smarter in the future
           // programLoaded();
            bkgScript();

            //Set the playing state of the viewport to false
            document.getElementById("viewport").isPlaying = false;

            //effectsWindow.files();

            //Get the theme
            var theme = localStorage.getItem("theme");
            if(theme == "light") {
                setTheme(0);
            } else if(theme == "dark") {
                setTheme(1);
            } else if(theme == "cancer") {
                setTheme(2);
            }


            document.getElementById("files").addEventListener("drop", function(e) {
                console.log(e.target.closest("#files"));
            })


            //Hide the notifications menu
/*            var pane = document.getElementById("notification-pane");
            pane.style.display = "none";
            pane.innerHTML = "viktor var her XDDD";
            
        
            var searchFilesField = document.getElementById("files-search-field");
searchFilesField.addEventListener("keyup", function(event) {
    if (event.key === "Enter") {    
//Search for files


    }
});*/
        
        }

    </script>
</body>

</html>